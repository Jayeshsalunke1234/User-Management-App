<!doctype html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
  <head>
     <style>
        .container{
        display:flex;
        flex-direction:row;
        justify-content: center;
        align-content: center;
        box-shadow: 0px 0px black;
     }
     </style>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
<script src="/webjars/jquery/3.6.0/jquery.min.js"></script>
  <script >
     $(document).ready(function(){
    	 $('#countryId').on('change',function(){ 
    		 var selectedCountryId= $(this).val();
    		 console.log("jquery is working");
    		 $.ajax({
    			 url:'/states',
    			 type:'GET',
    			 data:{countryId : selectedCountryId},
    			 
    			 success: function (response){
    				
    				 //clear previous state  loades
    				 $('#stateId').empty();
    				 
    				 //add default option
    				 $('#stateId').append('<option value="">Select</option>');
    				 
    				 //populate dropdown
    				 $.each(response, function(key,value){
    					 $('<option>').val(key).text(value).appendTo('#stateId');
    				 });
    				 
    				 
    			 },
    			 error:function(xhr,status,error){
    				 console.error('AJAX ERROR:', error)
    			 }
    		 });
    	 });
    	 $('#stateId').on('change',function(){ 
    		 var selectedStateId= $(this).val();
    		 $.ajax({
    			 url:'/cities',
    			 type:'GET',
    			 data:{stateId : selectedStateId},
    			 
    			 success: function (response){
    				
    				 //clear previous state  loades
    				 $('#cityId').empty();
    				 
    				 //add default option
    				 $('#cityId').append('<option value="">Select</option>');
    				 
    				 //populate dropdown
    				 $.each(response, function(key,value){
    					 $('<option>').val(key).text(value).appendTo('#cityId');
    				 });
    				 
    				 
    			 },
    			 error:function(xhr,status,error){
    				 console.error('AJAX ERROR:', error)
    			 }
    		 });
    	 });
     });
       
  </script>
  
  </head>
  <body>
  
         <div class="container">
               <form th:action="@{handleRegister}" th:object="${user}" method="post">
                    <h1>Register Page</h1>
                    <font style="color:green"><span th:text="${smsg}"></span></font>
                   <font style="color:green"><span th:text="${emsg}"></span></font>

                    <br>
                
                     <table>
                       <tr>
                           <td>Name:</td>
                           <td><input type="text" th:field="*{uname}" required="required"></td>
                        </tr>
                        <tr>
                           <td>Email:</td>
                           <td><input type="email" th:field="*{email}" required="required"></td>
                        </tr>
                         <tr>
                           <td>Password:</td>
                           <td><input type="password" th:field="*{pwd}" required="required"></td>
                        </tr>
                         <tr>
                           <td>Phno:</td>
                           <td><input type="number" th:field="*{phno}" required="required"></td>
                        </tr>
                         <tr>
                           <td>Country:</td>
                           <td><select id="countryId" th:field="*{countryId}">
                                <option value="">-Select-</option>
                                <option th:each="entry: ${country != null ? country.entrySet(): {}}" 
                                th:value="${entry.key}" 
                                th:text="${entry.value}"></option>
                           </select></td>
                        </tr>
                        <tr>
                           <td>States:</td>
                           <td><select id="stateId" th:field="*{stateId}">
                            <option value="">-Select-</option> 
                           </select></td>
                        </tr>
                         <tr>
                           <td>City:</td>
                           <td><select id="cityId" th:field="*{cityId}">
                            <option value="">-Select-</option>   
                           </select></td>
                        </tr>
                        
                        <tr>
                           <td><input type="submit"  value="Submit" class="btn btn-primary"></td>
                        </tr>
                        <tr>
                           
                           <td><a href="/">Click Here to Login</a></td>
                        </tr>
                       
                        
                     </table>
               </form>
         </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
  </body>
</html>